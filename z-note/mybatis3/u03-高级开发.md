# 1. 动态条件标签

**概念：** 条件标签配合OGNL表达式用于判断是否允许拼接部分指定的SQL语句：
- `<if>`：用于单独条件判断：
    - 使用 `test` 属性设置条件，OGNL表达式建议用单引号，以免冲突表达式中的字符串。
- `<choose>`：用于多选一条件判断：
    - 子标签 `<when>` 使用 `test` 属性设置条件，OGNL表达式建议用单引号，以免冲突表达式中的字符串。
    - 子标签 `<otherwise>` 用于设置所有条件均不满足时的处理。
- `<where>`：WHERE语句不为空时，生成 `WHERE` 关键字并删除WHERE语句中第一个 `AND`。 
- `<trim prefix="WHERE" prefixOverrides="AND|OR">`：WHERE语句不为空时，生成 `WHERE` 前缀关键字并删除WHERE语句中第一个 `AND` 或 `OR`。 

**源码：** /mybatis3/
- res: `classpath:mybatis-dynamic.xml`
- res: `classpath:com/joezhou/mapper/UserMapper.xml`
- src: `c.j.pojo.User`
- src: `c.j.mapper.UserMapper`
- tst: `c.j.dynamic.UserTest.findByIf()`
- tst: `c.j.dynamic.UserTest.findByWhere()`
- tst: `c.j.dynamic.UserTest.findByTrim()`
- tst: `c.j.dynamic.UserTest.findByChoose()`

# 2. 动态循环标签

**概念：** 循环标签 `<foreach>` 用于循环拼接部分指定的SQL语句：
- `collection`：值固定为 `array` 或 `list` 或一个Map结构（值为数组或列表）的KEY。
- `items`：设置循环中间变量。
- `open/close`：设置循环开始/结束时拼接的字符串SQL代码。
- `separator`：设置拼接符，自动忽略SQL语句中多余的拼接符。

**源码：** /mybatis3/
- res: `classpath:mybatis-dynamic.xml`
- res: `classpath:com/joezhou/mapper/UserMapper.xml`
- src: `c.j.pojo.User`
- src: `c.j.mapper.UserMapper`
- tst: `c.j.dynamic.UserTest.findWithArray()`
- tst: `c.j.dynamic.UserTest.findWithList()`
- tst: `c.j.dynamic.UserTest.findWithMap()`

# 3. 动态修改标签

**概念：** 修改标签 `<set>` 用于控制修改操作时，忽略null字段：
- `<set>`：生成 `SET` 关键字并删除SET语句中最后一个 `,`。 
- `<trim prefix="SET" suffixOverrides=",">`：生成 `SET` 前缀关键字并删除SET语句中最后一个 `,`。

**源码：** /mybatis3/
- res: `classpath:mybatis-dynamic.xml`
- res: `classpath:com/joezhou/mapper/UserMapper.xml`
- src: `c.j.pojo.User`
- src: `c.j.mapper.UserMapper`
- tst: `c.j.dynamic.UserTest.updateBySet()`
- tst: `c.j.dynamic.UserTest.updateByTrim()`

# 4. 多参数@Param

**需求：** 找到所有名中含"王"的男同学。

**配置：** StudentMapper.xml 中修改
```xml
<select id="retrieveByNameAndGender" resultMap="studentMap">
    SELECT <include refid="cols"/> FROM `student`
    <where>
        <if test='stuName != null'>
            AND `stu_name` LIKE "%"#{stuName}"%"
        </if>
        <if test='stuGender != null'>
            AND `stu_gender` = #{stuGender}
        </if>
    </where>
</select>
```

# 3. Mapper接口

**概念：** 如果接口方法的参数是多个，则需要使用 `@Param` 进行分别标注。

**源码：** StudentMapper.java
```java
/**
 * 找到所有名中含"王"的男用户
 *
 * @param name   姓名
 * @param gender 性别
 * @return 满足条件的用户
 */
List<User> findByNameAndGender(
        @Param("name") String name,
        @Param("gender") String gender);
```

# 4. 测试

**源码：** junit测试
```java
@Test
public void retrieveByNameAndGender() {
    String stuName = "王";
    String stuGender = "male";
    List<Student> students = mapper.retrieveByNameAndGender(stuName, stuGender);
    System.out.println(students);
}
```

# 8. 内置参数

**概念：** 如果客户没有调用接口方法，而是直接通过另一个SQL块直接调用了这个SQL块，则这个SQL块中是无法解析 `@Param` 中定义的参数的，所以我们还有另一种方法来获取参数，就是使用  `_parameter`，它是MyBatis的内置参数，它代表整个参数集。

# 2. 一个简单参数

**概念：** 如果接口方法传递过来的是一个简单参数，则 `_parameter` 代表这个简单参数：
- 如果没设置 `@Param`，则 `#{}` 填写任何值均可获取这个参数。
- 如果设置了 `@Param("a")`，则只有 `#{a}` 或 `#{param1}` 可以获取这个参数。

## 2.1 Mapper配置

**配置：** StudentMapper.xml
```xml
<select id="test01" resultMap="studentMap">
    SELECT <include refid="cols"/> FROM `student`
    <where>
        <if test='_parameter != null'>
            AND `stu_name` like "%"#{param1}"%"
        </if>
    </where>
</select>
```

## 2.2 Mapper接口

**源码：** StudentMapper.java
```java
/**
 * 根据姓名模糊查询学生信息
 *
 * @param stuName 姓名
 * @return 符合条件的学生信息
 */
List<Student> test01(String stuName);
```

## 2.3 测试

**源码：** junit测试
```java
@Test
public void test01() {
    String stuName = "王";
    List<Student> students = mapper.test01(stuName);
    System.out.println(students);
}
```

# 3. 两个简单参数

**概念：** 如果接口方法传递过来的是两个简单参数，则 `_parameter` 代表这两个简单参数的集合：
- 如果没设置 `@Param`：
    - `_parameter.get("param1")` 或 `_parameter.get("arg0")` 表示第一个参数。
    - `_parameter.get("param2")` 或 `_parameter.get("arg1")` 表示第二个参数。
    - `#{param1}` 或 `#{arg0}` 可以获取第一个参数。
    - `#{param2}` 或 `#{arg1}` 可以获取第二个参数。
- 如果设置了 `@Param("a")` 和 `@Param("b")`：
    - `_parameter.get("param1")` 或 `_parameter.get("a")` 表示第一个参数。
    - `_parameter.get("param2")` 或 `_parameter.get("b")` 表示第二个参数。
    - `#{param1}` 或 `#{a}` 可以获取第一个参数。
    - `#{param2}` 或 `#{b}` 可以获取第二个参数

## 3.1 Mapper配置

**配置：** StudentMapper.xml
```xml
<select id="test02" resultMap="studentMap">
    SELECT <include refid="cols"/> FROM `student`
    <where>
        <if test='_parameter.get("param1") != null'>
            AND `stu_name` like "%"#{param1}"%"
        </if>
        <if test='_parameter.get("param2") != null'>
            AND `stu_gender` = #{param2}
        </if>
    </where>
</select>
```

## 3.2 Mapper接口

**源码：** StudentMapper.java
```java
/**
 * 根据姓名模糊和性别精准查询学生信息
 *
 * @param stuName 姓名
 * @param stuGender  性别
 * @return 符合条件的学生信息
 */
List<Student> test02(String stuName, String stuGender);
```

## 3.3 测试

**源码：** junit测试
```java
@Test
public void test02() {
    String stuName = "王";
    String stuGender = "male";
    List<Student> students = mapper.test02(stuName, stuGender);
    System.out.println(students);
}
```

# 4. 一个POJO参数

**概念：** 如果接口方法传递过来的是一个POJO参数，则 `_parameter` 代表这个POJO参数：
- 如果没设置 `@Param`：
    - `_parameter.stuName` 表示POJO中的 `stuName` 属性。
    - `#{stuName}` 可以获取POJO中的 `stuName` 属性。
- 如果设置了 `@Param("a")`：
    - `_parameter.a` 或 `_parameter.param1` 表示这个POJO参数。
    - `_parameter.a.stuName` 或 `_parameter.param1.stuName` 表示POJO中的 `stuName` 属性。
    - `#{a.stuName}` 或 `#{param1.stuName}` 可以获取POJO中的 `stuName` 属性。

## 4.1 Mapper配置

**配置：** StudentMapper.xml
```xml
<select id="test03" resultMap="studentMap">
    SELECT <include refid="cols"/> FROM `student`
    <where>
        <if test='_parameter.param1 != null'>
            <if test='_parameter.param1.stuName != null'>
                AND `stu_name` like "%"#{param1.stuName}"%"
            </if>
            <if test='_parameter.param1.stuGender != null'>
                AND `stu_gender` = #{param1.stuGender}
            </if>
        </if>
    </where>
</select>
```

## 4.2 Mapper接口

**源码：** StudentMapper.java
```java
/**
 * 根据学生实体中的姓名和性别查询学生信息
 *
 * @param student 学生实体
 * @return 符合条件的学生信息
 */
List<Student> test03(Student student);
```

## 4.3 测试

**源码：** junit测试
```java
@Test
public void test03() {
    Student student = new Student();
    student.setStuName("王");
    student.setStuGender("male");
    List<Student> students = mapper.test03(student);
    System.out.println(students);
}
```

