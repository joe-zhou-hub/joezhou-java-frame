# 1. 整合spring

**概念：**
- 添加依赖：
    - `mybatis`：mybatis/mysql-connector-java/commons-dbcp
    - `spring`：spring-core/spring-beans/spring-aspects
    - `spring`：spring-context/spring-context-support/spring-expression
    - `log`：log4j-core/log4j/slf4j-api/slf4j-log4j12
    - `other`：lombok/junit/spring-test
- 开发实体类。
- 开发mybatis主配文件：只配置别名，SQL配置文件扫描和数据源交给spring做。

**源码：** /mybatis3/
- res: `pom.xml`
- res: `mybatis/mybatis.xml`
- src: `c.j.pojo.Dog`

## 1.1 原生DAO整合

**概念：** 原生DAO不使用接口方式开发：
- 开发SQL配置文件：编写查询语句块。
- 开发数据类 `DogDao`：继承 `SqlSessionDaoSupport` 以使用 `getSqlSession()` 获取session对象
- spring主配中，加载属性文件：
    - `<context:property-placeholder location="db.properties">`
- spring主配中，IOC数据源：
    - `<bean id="dataSource" class="o.a.c.dbcp.BasicDataSource">`。
    - DI：数据源的驱动串，连接串，账号密码等信息。
- spring主配中，IOC会话工厂：
    - `<bean id="sqlSessionFactory" class="o.m.s.SqlSessionFactoryBean">`
    - DI：`configLocation` 注入mybatis的主配文件。
    - DI：`dataSource`：引用容器中的数据源。
    - DI：`mapperLocations`：注入mybatis的SQL配置文件。
- spring主配中，IOC `DogDao`：
    - `id`：唯一标识，测试时会使用到。
    - `class`：原生DAO的类全名。
    - 注入 `sqlSessionFactory`，引用容器中的 `sqlSessionFactory`。

**配置：** com/joe/mapper/UserMapper.xml
```xml
<mapper namespace="userSpace">
    
    <cache readOnly="true"/>

    <select id="find" resultType="user">
        SELECT `id`, `name`, `age`, `gender` FROM `user`
    </select>
    
</mapper>
```

# 3. 原生DAO开发

**概念：** 

**源码：** UserDao.java
```java
/**
 * @author JoeZhou
 */
public class UserDao extends SqlSessionDaoSupport {
    
    public List<User> find() {
        return super.getSqlSession().selectList("userSpace.find");
    }
}
```

# 4. spring配置

**概念：**


**配置：** spring/spring-core.xml
```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context-4.0.xsd">

    <!--加载属性文件-->
    <context:property-placeholder location="classpath:db.properties"/>

    <!--数据源-->
    <bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource">
        <property name="driverClassName" value="${jdbc.driver}"/>
        <property name="url" value="${jdbc.url}"/>
        <property name="username" value="${jdbc.username}"/>
        <property name="password" value="${jdbc.password}"/>
        <property name="initialSize" value="${jdbc.initialSize}"/>
        <property name="maxActive" value="${jdbc.maxActive}"/>
        <property name="minIdle" value="${jdbc.minIdle}"/>
        <property name="maxIdle" value="${jdbc.maxIdle}"/>
        <property name="maxWait" value="${jdbc.maxWait}"/>
    </bean>

    <!--配置SqlSessionFactory-->
    <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">

        <!--配置mybatis主配文件-->
        <property name="configLocation" value="mybatis/mybatis-core.xml"/>

        <!--配置数据源-->
        <property name="dataSource" ref="dataSource"/>

        <!--配置mapper.xml文件-->
        <property name="mapperLocations" value="com/joe/mapper/*Mapper.xml"/>
    </bean>

    <!--原生DAO的bean-->
    <bean class="com.joe.dao.UserDao">
        <property name="sqlSessionFactory" ref="sqlSessionFactory"/>
    </bean>
</beans>
```

# 5. 测试

**源码：** junit测试
```java
/**
 * @author JoeZhou
 */
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration("classpath:spring/spring-core.xml")
public class UserTest {

    @Autowired
    private UserDao userDao;

    @Test
    public void retrieveAll() {
        List<User> users = userDao.retrieveAll();
        System.out.println(users);
    }
}
```
