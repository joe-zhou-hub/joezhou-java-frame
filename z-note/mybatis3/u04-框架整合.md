# 1. 整合准备

**流程：** 
- 添加依赖：
    - mybatis/mysql-connector-java/commons-dbcp2
    - spring-core/spring-beans/spring-aspects/spring-tx/spring-jdbc
    - spring-context/spring-context-support/spring-expression
    - log4j-core/log4j/slf4j-api/slf4j-log4j12
    - lombok/junit/spring-test/mybatis-spring
- 开发对应小狗表的小狗实体类。
- 开发mybatis主配文件：配置别名，SQL配置文件扫描和数据源交给spring做。

**源码：** /mybatis3/
- res: `pom.xml`
- res: `classpath:mybatis-sm.xml`
- src: `c.j.pojo.Dog`
- src: `c.j.pojo.Cat`

# 2. 原生DAO整合

**流程：**
- 开发SQL配置文件：编写CRUD语句块，不使用接口所以无需四大对应。
- 开发数据层接口和实现类：继承SM整合包中的 `SqlSessionDaoSupport`：
    - `getSqlSession()`：获取一个spring管理的session对象，不支持手动提交回滚和关闭。
- 开发spring主配文件并加载属性文件：
    - `<context:property-placeholder location="classpath:属性文件">`
- 在spring主配文件中IOC连接池 `o.a.c.d.BasicDataSource`：
    - 将驱动串等数据源信息DI给DBCP连接池的对应属性。
- 在spring主配文件中IOC会话工厂 `o.m.s.SqlSessionFactoryBean`：
    - 将mybatis的主配文件DI给 `configLocation` 属性。
    - 将连接池DI给 `dataSource` 属性。
    - 将SQL配置文件DI给 `mapperLocations` 属性。
- 在spring主配中IOC数据层实现类：
    - 将会话工厂DI给 `sqlSessionFactory` 属性（其父类的SET方法）。

**源码：** /mybatis3/
- res: `classpath:c.j.mapper.DogMapper.xml`
- res: `classpath:sprint/spring-dog.xml`
- src: `c.j.dao.DogDao`
- src: `c.j.dao.impl.DogDaoImpl`
- tst: `c.j.sm.DogTest`

# 3. 接口Mapper整合

**流程：**
- 开发SQL配置文件：编写CRUD语句块，需要和接口四大对应。
- 开发Mapper接口，建议与SQL配置文件同名同包。
- 开发spring主配文件并加载属性文件：
    - `<context:property-placeholder location="classpath:属性文件">`
- 在spring主配文件中IOC连接池 `o.a.c.d.BasicDataSource`：
    - 将驱动串等数据源信息DI给DBCP连接池的对应属性。
- 在spring主配文件中IOC会话工厂 `o.m.s.SqlSessionFactoryBean`：
    - 将mybatis的主配文件DI给 `configLocation` 属性。
    - 将连接池DI给 `dataSource` 属性。
    - 将SQL配置文件DI给 `mapperLocations` 属性，接口和配置文件同名同包时可省略。
- 在spring主配文件中IOC接口扫描类 `o.m.s.m.MapperFactoryBean`：
    - 将接口类全名DI给 `mapperInterface` 属性。
    - 将会话工厂DI给 `sqlSessionFactory` 属性。
- 在spring主配文件中IOC接口包扫描类 `o.m.s.m.MapperScannerConfigurer`：
    - 将接口所在包名DI给 `basePackage` 属性。
    - 包中所有接口的 `<bean>` 的id都默认为接口名首字母小写。
- 在spring主配文件中IOC单个接口 `o.m.s.m.MapperFactoryBean`：
    - 将接口全名DI给 `mapperInterface` 属性。
    - 将会话工厂DI给 `sqlSessionFactory` 属性。
    - 此方法与接口包扫描方法不共存。

**源码：** /mybatis3/
- res: `classpath:c.j.mapper.CatMapper.xml`
- res: `classpath:sprint/spring-cat.xml`
- src: `c.j.mapper.CatMapper`
- tst: `c.j.sm.CatTest`

# 4. 逆向工程