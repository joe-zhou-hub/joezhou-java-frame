# 1. 整合准备

**流程：** 
- 添加依赖：
    - mybatis/mysql-connector-java/commons-dbcp2
    - spring-core/spring-beans/spring-aspects/spring-tx/spring-jdbc
    - spring-context/spring-context-support/spring-expression
    - log4j-core/log4j/slf4j-api/slf4j-log4j12
    - lombok/junit/spring-test/mybatis-spring
- 开发对应小狗表的小狗实体类。
- 开发mybatis主配文件：配置别名，SQL配置文件扫描和数据源交给spring做。

**源码：** /mybatis3/
- res: `pom.xml`
- res: `classpath:mybatis-sm.xml`
- src: `c.j.pojo.Dog`
- src: `c.j.pojo.Cat`

# 2. 原生DAO整合

**流程：**
- 开发SQL配置文件：编写CRUD语句块，不使用接口所以无需四大对应。
- 开发数据层接口和实现类：继承SM整合包中的 `SqlSessionDaoSupport`：
    - `getSqlSession()`：获取一个spring管理的session对象，不支持手动提交回滚和关闭。
- 开发spring主配文件并加载属性文件：
    - `<context:property-placeholder location="classpath:属性文件">`
- 在spring主配文件中IOC连接池 `o.a.c.d.BasicDataSource`：
    - 将驱动串等数据源信息DI给DBCP连接池的对应属性。
- 在spring主配文件中IOC会话工厂 `o.m.s.SqlSessionFactoryBean`：
    - 将mybatis的主配文件DI给 `configLocation` 属性。
    - 将连接池DI给 `dataSource` 属性。
    - 将SQL配置文件DI给 `mapperLocations` 属性。
- 在spring主配中IOC数据层实现类：
    - 将会话工厂DI给 `sqlSessionFactory` 属性（其父类的SET方法）。

**源码：** /mybatis3/
- res: `classpath:c.j.mapper.DogMapper.xml`
- res: `classpath:sprint/spring-dog.xml`
- src: `c.j.dao.DogDao`
- src: `c.j.dao.impl.DogDaoImpl`
- tst: `c.j.sm.DogTest`

# 3. 接口Mapper整合

**流程：**
- 开发SQL配置文件：编写CRUD语句块，需要和接口四大对应。
- 开发Mapper接口，建议与SQL配置文件同名同包。
- 开发spring主配文件并加载属性文件：
    - `<context:property-placeholder location="classpath:属性文件">`
- 在spring主配文件中IOC连接池 `o.a.c.d.BasicDataSource`：
    - 将驱动串等数据源信息DI给DBCP连接池的对应属性。
- 在spring主配文件中IOC会话工厂 `o.m.s.SqlSessionFactoryBean`：
    - 将mybatis的主配文件DI给 `configLocation` 属性。
    - 将连接池DI给 `dataSource` 属性。
    - 将SQL配置文件DI给 `mapperLocations` 属性，接口和配置文件同名同包时可省略。
- 在spring主配文件中IOC接口扫描类 `o.m.s.m.MapperFactoryBean`：
    - 将接口类全名DI给 `mapperInterface` 属性。
    - 将会话工厂DI给 `sqlSessionFactory` 属性。
- 在spring主配文件中IOC接口包扫描类 `o.m.s.m.MapperScannerConfigurer`：
    - 将接口所在包名DI给 `basePackage` 属性。
    - 包中所有接口的 `<bean>` 的id都默认为接口名首字母小写。
- 在spring主配文件中IOC单个接口 `o.m.s.m.MapperFactoryBean`：
    - 将接口全名DI给 `mapperInterface` 属性。
    - 将会话工厂DI给 `sqlSessionFactory` 属性。
    - 此方法与接口包扫描方法不共存。

**源码：** /mybatis3/
- res: `classpath:c.j.mapper.CatMapper.xml`
- res: `classpath:sprint/spring-cat.xml`
- src: `c.j.mapper.CatMapper`
- tst: `c.j.sm.CatTest`

# 4. 逆向工程

**概念：** mybatis逆向工程用于根据数据表生成对应的实体类，包含CRUD语句块的SQL配置文件，对应SQL配置文件的Mapper接口，mybatis主配置文件等，仅支持单表：
- 添加依赖：
    - mybatis/mybatis-generator-core/mysql-connector-java
- 开发逆向工程主配文件：放在工程的根目录下，而非classpath下：
    - `<plugin>`：配置逆向工程插件，如序列化，`toString()` 等。
    - `<commentGenerator>`：配置是否添加工程注释。
    - `<jdbcConnection>`：配置JDBC连库信息。
    - `<javaTypeResolver>`：配置实体类个别属性类型解析规则。
    - `<javaModelGenerator>`：配置实体类生成位置。
    - `<sqlMapGenerator>`：配置SQL配置文件生成位置。
    - `<javaClientGenerator>`：配置Mapper接口生成位置。
    - `<table>`：配置根据哪些数据库表生成信息。
- 开发主类并使用main方法运行逆向工程：再次生成时要先将之前生成的所有文件删除，否则信息叠加。

**源码：** /mybatis3-generator/
- res: `pom.xml`
- res: `generator.xml`
- src: `c.j.app.Generator`

## 4.1 DML方法

**概念：** 
- `insert()`：缺省字段注入null，无主键回注，静态SQL。
- `insertSelective()`：缺省字段被忽略，无主键回注，动态SQL。
- `updateByPrimaryKey()`：按主键修改，缺省字段注入null，静态SQL。
- `updateByPrimaryKeySelective()`：按主键修改，缺省字段被忽略，动态SQL。
- `updateByExample(XXXExample example)`：按条件修改，缺省字段注入null，静态SQL：
    - `example.createCriteria().条件()`：设置and条件。
    - `example.or().条件()`：设置or条件。
- `updateByExampleSelective(XXXExample example)`：按条件修改，缺省字段被忽略，动态SQL。
- `deleteByPrimaryKey()`：按主键删除信息。
- `deleteByExample(XXXExample example)`：按条件删除信息。

**源码：** /mybatis3-generator/
- res: `classpath:mybatis-generator.xml`
- tst: `c.j.generator.UserTest.insert()`
- tst: `c.j.generator.UserTest.updateByPrimaryKey()`
- tst: `c.j.generator.UserTest.updateByExample()`
- tst: `c.j.generator.UserTest.deleteByPrimaryKey()`
- tst: `c.j.generator.UserTest.deleteByExample()`

## 4.2 DQL方法

**概念：** 
- `selectByPrimaryKey()`：通过主键查询信息。
- `selectByExample(XXXExample example)`：通过条件查询符合的信息，空对象视为全查：
    - `example.setOrderByClause()`：对结果集进行排序。
    - `example.setDistinct()`：对结果集去重。
    - `example.setOrderByClause()`：对结果集进行排序。
- `countByExample(XXXExample example)`：通过条件查询符合的条目数。

**源码：** /mybatis3-generator/
- res: `classpath:mybatis-generator.xml`
- tst: `c.j.generator.UserTest.selectByPrimaryKey()`
- tst: `c.j.generator.UserTest.selectByExample()`
- tst: `c.j.generator.UserTest.countByExample()`
