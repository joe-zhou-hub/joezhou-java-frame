# 1. 请求参数转换

**概念：** 处理器适配器中可配置自定义类型转换器，用于将请求参数类型转成自定义类型：
- 开发转换器类：实现 `o.s.c.c.c.Converter<A, B>` 接口并重写 `convert()`：
    - 该转换器仅在动作方法使用B类型变量接收A类型请求参数时生效。
- 配置转换器类：主配文件中管理 `o.s.f.s.FormattingConversionServiceFactoryBean`：
    - 注入 `converters`：使用 `<set>` + `<bean>` 注入1或N个转换器类全名。
    - 使用 `<mvc:annotation-driven />` 的 `conversion-service` 引用转换器类。
- 使用转换注解：主配文件中管理 `o.s.f.s.FormattingConversionServiceFactoryBean`：
    - 无需注入 `converters`，否则转换注解失效，仍使用转换器类方式。
    - 使用 `@DateTimeFormat(pattern="")` 标记动作方法参数或实体类属性。
    - 异常信息存放在 `BindingResult` 参数中，其位置必须紧跟爆发异常的那个实体类参数。

**源码：** /springmvc4/
- res: `spring/springmvc.xml`
- src: `c.j.converter.StringToDateConverter`
- src: `c.j.controller.ConverterController`
- psm: `/api/converter/string-to-date`
- psm: `/api/converter/date-time-format`

# 2. 请求参数校验

**概念：** HibernateValidator是JSR303的拓展校验工具，用于校验请求参数是否满足指定格式：
- 添加依赖 `hibernate-validator`
- 主配中添加 `<mvc:annotation-driven />` 以驱动 `o.s.v.b.LocalValidatorFactoryBean` 校验类。
- 开发实体类：为属性标记HibernateValidator校验注解，多注解优先级从上到下：
    - `@Null`：被注释的元素必须为 null。
    - `@NotNull`：被注释的元素必须不为 null。
    - `@AssertTrue`：被注释的元素必须为 true。
    - `@AssertFalse`：被注释的元素必须为 false。
    - `@Min(value)`：被注释的元素必须是一个整数，其值必须大于或等于value。
    - `@Max(value)`：被注释的元素必须是一个整数，其值必须小于或等于value。
    - `@DecimalMin(value)`：被注释的元素必须是一个浮点数，其值必须大于或等于value。
    - `@DecimalMax(value)`：被注释的元素必须是一个浮点数，其值必须小于或等于value。
    - `@Size(max, min)`：被注释的元素的取值范围必须是介于min和max之间。
    - `@Digits (integer, fraction)`：被注释的元素必须是一个数字，其值必须在可接受的范围内。
    - `@Past`：被注释的元素必须是一个过去的日期。
    - `@Future`：被注释的元素必须是一个将来的日期。
    - `@Pattern(value)`：被注释的元素必须符合指定的正则表达式。
    - `@Email`：被注释的元素值必须是合法的电子邮箱地址。
    - `@Length`：被注释的字符串的长度必须在指定的范围内。
    - `@NotEmpty`：被注释的String类，Collection、Map、数组，是不能为null或者长度为0的。
    - `@Range`：被注释的元素必须在合适的范围内。
- 开发动作类：对动作方法实体类参数标记 `@Valid` 以对其启用HibernateValidator校验。
    - 异常信息存放在 `BindingResult` 参数中，其位置必须紧跟爆发异常的那个实体类参数。

**源码：** /springmvc4/
- res: `spring/springmvc.xml`
- src: `c.j.valid.HibernateValidatorController`
- psm: `/api/valid/hibernate-validator`
    - email=yy06200210@163.com&birth=2002-11-11

**配置：** pom.xml
```xml
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
    <version>6.0.13.Final</version>
</dependency>
```

**源码：** Teacher.java
```java
/**
 * @author JoeZhou
 */
@Data
public class Teacher {

    @NotNull
    @Email
    private String email;

    @NotNull
    @Past
    @DateTimeFormat(pattern = "yyyy-MM-dd")
    private Date birth;
} 
```

**源码：** JsrController.java
```java
/**
 * @author JoeZhou
 */
@RequestMapping("/api/valid/")
@Controller
public class HibernateValidatorController {

    @ResponseBody
    @RequestMapping("hibernate-validator")
    public String hibernateValid(@Valid Teacher teacher, BindingResult result) {
        if (result.hasErrors()) {
            System.out.println("爆发了" + result.getErrorCount() + "个异常！");
            for (ObjectError e : result.getAllErrors()) {
                System.out.println("爆发异常的对象是：" + e.getObjectName());
                System.out.println("具体异常的内容为：" + e.getDefaultMessage());
            }
        }
        System.out.println(teacher);
        return "ok";
    }
}
```
