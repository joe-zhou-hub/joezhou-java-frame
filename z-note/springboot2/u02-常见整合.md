# 1. 整合logback

**概念：** `spring-boot-starter` 依赖中包含了 `spring-boot-starter-logging` 依赖，即springboot默认使用logback作为日志框架，它是log4j的改进版，不能单独使用，推荐配合slf4j一起使用：
- springboot默认加载 `classpath:logback.xml` 或 `classpath:logback-spring.xml`：
- 自定义日志配置文件需要在主配文件中指定：`logging.config=classpath:console-log.xml`。

**流程：** 将日志打印在控制台：
- 配置控制台日志追加器 `<appender name="STDOUT" class="c.q.l.c.ConsoleAppender>`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
- 配置根日志记录器 `<root level="">`：仅记录INFO及以上级别的启动日志和运行时日志：
    - `level` 用于指定最低日志级别，TRACE < DEBUG < INFO < WARN < ERROR < ALL，不区分大小写。
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
- 开发动作类：并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

**流程：** 将日志输出到日志文件：
- 配置文件日志追加器 `<appender name="WARN" class="c.q.l.c.r.RollingFileAppender">`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
    - `<file>`：指定日志文件路径，默认位置相对于所在项目，支持使用绝对路径。
    - `<append>`：设置是否追加日志，默认为true。
- 配置日志过滤器：`<filter class="c.q.l.c.f.LevelFilter">`：
    - `<level>ERROR</level>`：指定日志等级为ERROR。
    - `<onMatch>DENY</onMatch>`：ERROR级别日志阻止记录。
    - `<onMismatch>ACCEPT</onMismatch>`：除ERROR之外的级别日志允许记录。
- 配置日志滚动策略：`<rollingPolicy class="c.q.l.c.r.SizeAndTimeBasedRollingPolicy">`：
    - 策略：先按照日期，将日志信息记录到日志文件中，如 `a.log`，若日期变化，将前一天的日志文件重命名为 `a.日期.1.log`，之后新日志文件名字仍使用 `a.log`，若日期未变，日志文件大小超过某值，如100M，则拆分日志文件，如将 `a.log` 拆为 `a.日期.1.log` 和 `a.日期.2.log`：
    - `<fileNamePattern>`：建议使用 `log/warn.%d.%i.log`。
    - `<maxHistory>`：每个日志文件最大存活时间，单位根据 `<fileNamePattern>` 自动识别。
    - `<totalSizeCap>`：所有日志文件最大值，如 `10GB`，超出 `10GB` 立刻删除多余日志。
    - `<maxFileSize>`：每个日志文件切分阈值，默认 `10MB`，文件大小超过此值时进行切分。
- 配置运行时日志记录器：`<logger name="c.j.app" level="WARN">`：仅记录指定包中WARN及以上级别日志：
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
    - `<logger>` 针对指定包进行日志记录，可存在多个，但无法记录启动日志，启动日志需使用根记日志录器。
- 开发动作类：并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

> z-res/logback日志格式占位符.md

**源码：** /springboot2/
- res: `classpath:console-log.xml`
- res: `classpath:file-log.xml`
- src: `c.j.s.controller.LogBackController`
- psm: `api/logback/test`