# 1. 整合logback

**概念：** `spring-boot-starter` 依赖中包含了 `spring-boot-starter-logging` 依赖，即springboot默认使用logback作为日志框架，它是log4j的改进版，不能单独使用，推荐配合slf4j一起使用：
- springboot默认加载 `classpath:logback.xml` 或 `classpath:logback-spring.xml`：
- 自定义日志配置文件需要在主配文件中指定：`logging.config=classpath:console-log.xml`。
- 日志级别：TRACE < DEBUG < INFO < WARN < ERROR < ALL，不区分大小写。

**流程：** 将日志打印在控制台：
- 配置控制台追加器 `<appender name="STDOUT" class="c.q.l.c.ConsoleAppender>`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
- 配置根记录器 `<root level="INFO">`：仅记录INFO及以上级别的启动日志和运行时日志：
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
- 开发动作类并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

**流程：** 将日志输出到日志文件：
- 配置文件追加器 `<appender name="INFO" class="c.q.l.c.r.RollingFileAppender">`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
    - `<file>`：指定日志文件路径，默认位置相对于所在项目，支持使用绝对路径。
    - `<append>`：设置是否追加日志，默认为true。
- 配置过滤器：`<filter class="c.q.l.c.f.LevelFilter">`：
    - `<level>ERROR</level>`：指定参考日志等级为ERROR。
    - `<onMatch>DENY</onMatch>`：ERROR级别日志阻止记录。
    - `<onMismatch>ACCEPT</onMismatch>`：除ERROR之外的级别日志允许记录。
- 配置滚动策略：`<rollingPolicy class="c.q.l.c.r.SizeAndTimeBasedRollingPolicy">`：
    - 策略：先将日志记录到日志文件中，如 `my.log`：
        - 日期变化时将昨天的日志文件重命名为 `my.日期.1.log`，今天的日志文件名仍用 `my.log`。
        - 日志文件超过拆分阈值时，将 `my.log` 拆为 `my.日期.1.log` 和 `my.日期.2.log`。
    - `<fileNamePattern>`：日志文件格式，建议使用 `log/warn.%d.%i.log`。
    - `<maxHistory>`：日志文件最长时效，单位根据 `<fileNamePattern>` 自动识别。
    - `<totalSizeCap>`：全部日志文件最大值，如 `10GB`，超出 `10GB` 立刻删除多余日志。
    - `<maxFileSize>`：每个日志文件拆分阈值，默认 `10MB`，文件大小超过此值时进行切分。
- 配置运行时记录器：`<logger name="c.j.app" level="WARN">`：仅记录指定包中WARN及以上级别日志：
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
    - `<logger>` 针对指定包进行日志记录，可存在多个，但无法记录启动日志，启动日志需使用根记日志录器。
- 开发动作类：并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

> z-res/logback-pattern.md

**源码：** /springboot2/
- res: `classpath:console-log.xml`
- res: `classpath:file-log.xml`
- src: `c.j.s.controller.LogBackController`
- psm: `api/logback/test`

# 2. 整合Thymeleaf

**概念：** [Thymeleaf]() 是一种模版引擎，能处理HTML，XML，TEXT，JAVASCRIPT和CSS模板内容，springboot默认会顺序从 `/META-INF/resources`，`classpath:/resources/`，`classpath:/static/`，`classpath:/public/` 中寻找资源，有则直接返回，若都没有404：
- 添加依赖：`spring-boot-starter-thymeleaf`
- 主配添加：
    - `spring.web.resources.static-locations`：默认静态资源加载位置。
    - `spring.thymeleaf.enabled`：启用thymeleaf，默认true。
    - `spring.thymeleaf.cache`：启用thymeleaf缓存，默认true
    - `spring.thymeleaf.prefix`：配置thymeleaf响应路径前缀，默认classpath:/templates/。
    - `spring.thymeleaf.suffix`：配置thymeleaf响应路径后缀，默认.html。
    - `spring.thymeleaf.encoding`：配置thymeleaf编码，默认UTF-8。
- 动作类开发：响应路径自动补充主配中thymeleaf的前后缀。
- 页面开发：
    - 在 `<html>` 中添加thymeleaf的命名空间：`xmlns:th="http://www.thymeleaf.org"`。
    - 在HTML标签中使用` th:text="${msg }"` 可取出请求域中的值，该值支持 `+` 或 `|` 进行字符拼接。

**源码：** /springboot2/
- res: `classpath:application.properties`
- src: `c.j.s.controller.ThymeleafController`
- web: `classpath:templates/main.html`
- psm: `api/thymeleaf/test`

3. 友好页面

当系统报错时，返回到页面的内容通常是一些杂乱的代码段，这种显示对用户来说不友好，因此我们需要自定义一个友好的提示系统异常的页面。

在src/main/resources下创建 /public/error，在该目录下

创建一个4xx.html文件，该页面的内容就是当url路径找不到的时候返回给用户的内容
创建一个5xx.html文件，该页面的内容就是当系统报错时返回给用户浏览的内容

public/error/4xx.html
<h1>您访问的页面不存在！<a href="#">点我返回主页</a></h1>


public/error/5xx.html
<h1>系统内容出现错误！<a href="#">点我返回主页</a></h1>


2. 整合JSP

jsp和thymeleaf默认情况下无法共存，需要一些额外的配置，所以我们在测试jsp的时候，需要删除thymeleaf的相关配置。
由于SpringBoot使用的内嵌的tomcat，而内嵌的tamcat是不支持jsp页面的，所有需要导入额外的包才能解决。
我和springBoot都并不建议使用jsp。
如果真有需要知道jsp和thymeleaf共存的额外配置，还请自行查找。
 
<dependency>
    <groupId>org.apache.tomcat.embed</groupId>
    <artifactId>tomcat-embed-jasper</artifactId>
    <scope>provided</scope>
</dependency>



--------------------------------------------------------------------------------
 By Mr.Joe