# 1. 整合logback

**概念：** `spring-boot-starter` 依赖中包含了 `spring-boot-starter-logging` 依赖，即springboot默认使用logback作为日志框架，它是log4j的改进版，不能单独使用，推荐配合slf4j一起使用：
- springboot默认加载 `classpath:logback.xml` 或 `classpath:logback-spring.xml`：
- 自定义日志配置文件需要在主配文件中指定：`logging.config=classpath:console-log.xml`。
- 日志级别：TRACE < DEBUG < INFO < WARN < ERROR < ALL，不区分大小写。

**流程：** 将日志打印在控制台：
- 配置控制台追加器 `<appender name="STDOUT" class="c.q.l.c.ConsoleAppender>`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
- 配置根记录器 `<root level="INFO">`：仅记录INFO及以上级别的启动日志和运行时日志：
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
- 开发动作类并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

**流程：** 将日志输出到日志文件：
- 配置文件追加器 `<appender name="INFO" class="c.q.l.c.r.RollingFileAppender">`：
    - `<encoder>` + `<pattern>/<charset>`：配置日志格式/字符集。
    - `<file>`：指定日志文件路径，默认位置相对于所在项目，支持使用绝对路径。
    - `<append>`：设置是否追加日志，默认为true。
- 配置过滤器：`<filter class="c.q.l.c.f.LevelFilter">`：
    - `<level>ERROR</level>`：指定参考日志等级为ERROR。
    - `<onMatch>DENY</onMatch>`：ERROR级别日志阻止记录。
    - `<onMismatch>ACCEPT</onMismatch>`：除ERROR之外的级别日志允许记录。
- 配置滚动策略：`<rollingPolicy class="c.q.l.c.r.SizeAndTimeBasedRollingPolicy">`：
    - 策略：先将日志记录到日志文件中，如 `my.log`：
        - 日期变化时将昨天的日志文件重命名为 `my.日期.1.log`，今天的日志文件名仍用 `my.log`。
        - 日志文件超过拆分阈值时，将 `my.log` 拆为 `my.日期.1.log` 和 `my.日期.2.log`。
    - `<fileNamePattern>`：日志文件格式，建议使用 `log/warn.%d.%i.log`。
    - `<maxHistory>`：日志文件最长时效，单位根据 `<fileNamePattern>` 自动识别。
    - `<totalSizeCap>`：全部日志文件最大值，如 `10GB`，超出 `10GB` 立刻删除多余日志。
    - `<maxFileSize>`：每个日志文件拆分阈值，默认 `10MB`，文件大小超过此值时进行切分。
- 配置运行时记录器：`<logger name="c.j.app" level="WARN">`：仅记录指定包中WARN及以上级别日志：
    - `<appender-ref>` 使用 `ref` 属性关联某个追加器名，表示使用该追加器，可存在0或多个。
    - `<logger>` 针对指定包进行日志记录，可存在多个，但无法记录启动日志，启动日志需使用根记日志录器。
- 开发动作类：并通过 `LoggerFactory.getLogger(getClass())` 获取当前类的 `Logger` 实例：
    - `logger.debug/info/warn/error("")`：记录一条DEBUG/INFO/WARN/ERROR级别的日志信息。

> z-res/logback-pattern.md

**源码：** /springboot2/
- res: `classpath:console-log.xml`
- res: `classpath:file-log.xml`
- src: `c.j.s.controller.LogBackController`
- psm: `api/logback/test`

# 2. 整合页面

**概念：** 如果你想让浏览器直接访问你SpringBoot项目中的静态资源，则你的静态资源必须放在[META-INF/resources]、[resources]、[static]、[public]这几个文件夹中，且访问它们的时候，路径中不需要加这几个文件夹的名字，因为SpringBoot发现URL访问的是静态资源，会默认依次在这几个文件夹中开始查找，如果有则直接返回。

默认加载文件夹顺序：[META-INF/resources] > [src/main/resources/resources] > [src/main/resources/static] > [src/main/resources/public]

如果你想在springBoot项目中的任意位置使用HTML页面，那么Thymeleaf模版是你不可或缺的技术，它是一种模版引擎，主要目标是将优雅的自然模板带到您的开发工作流程中。

Thymeleaf能够处理两种标记模板模式（HTML和XML）和三种文本模板模式（TEXT，JAVASCRIPT和CSS）。
HTML模板模式：允许任何类型的HTML输入，包括HTML5，HTML4和XHTML，不会执行验证或格式检查，并且在输出中尽可能地遵守模板代码/结构。
XML模板模式：允许XML输入，在这种情况下，代码应该是格式良好的，没有未封闭的标签，没有未加引号的属性等，如果发现格式错误，解析器将会抛出异常。 
TEXT模板模式：允许TEXT文本的输入，包括文本电子邮件或模板文档等， HTML或XML模板也可以作为TEXT处理，在这种情况下，它们不会被解析为标记，而每个标记，包括<DOCTYPE>和注释等都将被视为纯文本。
JS模板模式：允许JS文件的输入，意味着能够像在HTML文件中一样使用JavaScript文件中的模型数据。
CSS模板模式：允许CSS文件的输入，意味着能够像在HTML文件中一样使用CSS文件中的样式美化。

官网地址：https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-developing-web-applications.html#boot-features-spring-mvc-static-content

在pom.xml文件中添加thymeleaf依赖
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-thymeleaf</artifactId>
</dependency>


tips：如果你不添加这个依赖，你的html文件就应该放在默认加载文件夹（resources、static、public）里面才可以访问。

在application.properties中添加模版配置
### 整合thymeleaf
# 默认静态资源加载位置
spring.resources.static-locations=\
  classpath:/META-INF/resources/,\
  classpath:/resources/,\
  classpath:/static/,\
  classpath:/public/,\
  classpath:/templates/
# 是否允许MVC使用Thymeleaf，默认true
spring.thymeleaf.enabled=true
# 是否开启模板缓存，默认true
spring.thymeleaf.cache=false
# 指定模板的前缀，默认为:classpath:/templates/
spring.thymeleaf.prefix=classpath:/templates/
# 指定模板的后缀，默认为:.html
spring.thymeleaf.suffix=.html
# 指定模板的编码，默认为: UTF-8
spring.thymeleaf.encoding=UTF-8


tips：开发时把缓存关闭，有利于看到实时页面，其他全部走默认值即可。

在classpath:/templates/下创建index.html



tips：首页也必须放在classpath:/templates/下才可以读取到。
tips：访问springboot不用添加项目名称，因为tomcat是内置的，一个tomcat只跑一个项目，所以不用在URL上指定运行的是哪一个项目。

控制层创建：LoginController.java
package com.joe.app.controller;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import java.util.Map;

/**
 * @author Joe
 */
@Controller
public class LoginController {
    @RequestMapping("/thymeleaf/login")
    public String login(Map<String, Object> map, String username) {
        String usernameFromDb = "admin";
        String loginSuccessMsg = "登录成功，欢迎你：" + username;
        String loginFailMsg = "登录失败";
        String msg = usernameFromDb.equals(username) ? loginSuccessMsg : loginFailMsg;
        map.put("msg", msg);
        // 这里搭配了application.properties中配置的前缀和后缀，组成/templates/html/main.html
        return "main";
    }
}


tips：类上不要使用@RestController，否则仍是返回json，不会跳转页面

在/templates/下创建main.html
<!--从map中取出msg-->
<h2 th:text="${msg }"></h2>

<!--${msg}可以直接跟字符串使用加号拼接-->
<h2 th:text="'前置字符串内容: ' + ${msg} + ' :后置字符串内容'"></h2>

<!--${msg}可以在两个竖线（|）之内格式化输出-->
<h2 th:text="|前置字符串内容: ${msg} :后置字符串内容|"></h2>


tips：如果页面端不支持th属性，可以在<html>标签上添加thymeleaf命名空间：<html lang="en" xmlns:th="http://www.thymeleaf.org">

取消thymeleaf变量红线
[File] - [setting] - [Editor] - [Code style] - [Inspections]
搜索[Thymeleaf] - 找到 [Expression variables validation]
[取消警告]



3. 友好页面

当系统报错时，返回到页面的内容通常是一些杂乱的代码段，这种显示对用户来说不友好，因此我们需要自定义一个友好的提示系统异常的页面。

在src/main/resources下创建 /public/error，在该目录下

创建一个4xx.html文件，该页面的内容就是当url路径找不到的时候返回给用户的内容
创建一个5xx.html文件，该页面的内容就是当系统报错时返回给用户浏览的内容

public/error/4xx.html
<h1>您访问的页面不存在！<a href="#">点我返回主页</a></h1>


public/error/5xx.html
<h1>系统内容出现错误！<a href="#">点我返回主页</a></h1>


2. 整合JSP

jsp和thymeleaf默认情况下无法共存，需要一些额外的配置，所以我们在测试jsp的时候，需要删除thymeleaf的相关配置。
由于SpringBoot使用的内嵌的tomcat，而内嵌的tamcat是不支持jsp页面的，所有需要导入额外的包才能解决。
我和springBoot都并不建议使用jsp。
如果真有需要知道jsp和thymeleaf共存的额外配置，还请自行查找。
 
<dependency>
    <groupId>org.apache.tomcat.embed</groupId>
    <artifactId>tomcat-embed-jasper</artifactId>
    <scope>provided</scope>
</dependency>



--------------------------------------------------------------------------------
 By Mr.Joe