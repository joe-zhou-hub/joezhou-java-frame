# 1. 一个核心三个组件

**概念：** 
- SpringMVC属于表现层的框架，它是Spring框架的一部分。
- SpringMVC的重要组成部分如下：
    - 一个核心：前端控制器 `DispatcherServlet`
    - 一号组件：处理器映射器 `HandlerMapping`
    - 二号组件：处理器适配器 `HandlerAdapter`
    - 三号组件：视图解析器 `ViewResolver`
    
> z-image/一个核心三个组件.png

**文字描述：**
- **请求来了：** 客户端发出一个http请求给web服务器，web服务器对该请求进行解析，如果符合 `DispatcherServlet` 的指定的映射规则，那么web容器就会将这个请求交给 `DispatcherServlet` 来进行下一步处理。

- **老大接收：** 请求被老大前端控制器 `DispatcherServlet` 接收：
    - `DispatcherServlet` 就相当于MVC模式中的C层， 是整个流程控制的中心。
    - `DispatcherServlet` 负责调用其它组件处理用户的请求。
    - `DispatcherServlet` 的存在降低了三大组件之间的耦合性。

- **一号小弟：** 老大召唤1号小弟处理器映射器 `HandlerMapping` 来寻找 `Handler`：
    - `HandlerMapping` 根据请求url找到具体的处理器 `Handler`。
    - `Handler` 是程序员自己开发的一个动作类，如 `UserController.java`。
    - `HandlerMapping` 将处理器和一些提前设计好的处理器拦截器(如果有)包装成一个执行链。
    - `HandlerMapping` 将执行链返回给老大。

- **二号小弟：** 老大召唤2号小弟处理器适配器 `HandlerAdapter` 来执行 `Handler`：
    - `HandlerAdapter` 执行执行链中的 `Handler`，得到一个结果对象 `ModelAndView`。
    - `HandlerAdapter` 采取适配器设计模式来进行工作，通过扩展适配器可以对更多类型的处理器进行执行。
    - `HandlerAdapter` 将 `ModelAndView` 返回给老大。

- **三号小弟：** 老大召唤3号小弟视图解析器 `ViewResolver` 来解析 `ModelAndView`：
    - `ViewResolver` 将 `ModelAndView` 中的逻辑视图名解析成物理视图名（即具体的页面地址）。
    - `ViewResolver` 生成一个具体的 `View` 对象。
    - `ViewResolver` 将 `View` 对象返回给老大。 

- **渲染视图：** 老大将 `View` 对象渲染成页面，然后响应给客户：
    - 渲染就是将模型数据填充至视图中的过程。
    - springmvc框架提供了很多的View视图类型的支持，包括：jstlView、freemarkerView、pdfView等，最常用的视图就是JSP和HTML。
    - 一般情况下需要通过页面标签或页面模版技术将模型数据通过页面展示给用户，需要由程序员根据业务需求开发具体的页面。

# 1. 依赖

**链接：** [springmvc413.zip]()

**配置：** pom.xml
```xml
<!--spring-webmvc-->
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-webmvc</artifactId>
    <version>4.1.3.RELEASE</version>
</dependency>
```

# 2. 前端控制器

**概念：** 在 `web.xml` 中配置SpringMVC的前端控制器 `DispatcherServlet`
- `<servlet-name>`：配对名。
- `<servlet-class>`：核心控制器类的类全名。
- `<init-param>`：设置在容器初始化的时候，自动加载SpringMVC的核心配置文件的路径
    - 默认加载位置：`/WEB-INF/配对名的值-servlet.xml`
- `<url-pattern>` 设置前端控制器的拦截规则：
    - `/`：表示拦截一切，但是不拦截 `*.jsp` 这种后缀类型的url（非静态资源）。
    - `/*`：永远不要这样写。
    - `/user/createUser.action`：表示只拦截 `/user/createUser.action` 请求。
    - `*.action`：表示只拦截以 `.action` 为后缀的请求，注意前面不要加 `/`。

**配置：** web.xml
```xml
<servlet>
    <servlet-name>dispatcherServlet</servlet-name>
    <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
    <init-param>
        <param-name>contextConfigLocation</param-name>
        <param-value>classpath:springmvc/springmvc.xml</param-value>
    </init-param>
    <load-on-startup>1</load-on-startup>
</servlet>

<servlet-mapping>
    <servlet-name>dispatcherServlet</servlet-name>
    <url-pattern>*.action</url-pattern>
</servlet-mapping>
```

# 3. 核心配置

**概念：** 因为SpringMVC本身就是Spring的子项目，对Spring兼容性很好，所以不需要做很多配置，这里只配置三大组件和一个Controller扫描就可以了。
- `<mvc:annotation-driven />`：注解驱动负责配置处理器映射器和处理器适配器这两个组件，而视图解析器这个组件，需要我们使用手动配置 `<bean>`，因为要为其配置前后缀，当然也可以不配置。
- 视图解析器使用SpringMVC框架默认的 `InternalResourceViewResolver` 这个类。
- 视图解析器的前后缀配置只作用于响应路径，不作用于请求路径。

**链接：** [Spring413_DTDs.zip](http://note.youdao.com/noteshare?id=e38c0f3b9a478c9f751487036cf7726b&sub=53CE50C94304455E86FDCE605B4D6ACE)

**配置：** springmvc/springmvc.xml
```xml
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans 
           http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/mvc 
           http://www.springframework.org/schema/mvc/spring-mvc.xsd
           http://www.springframework.org/schema/context 
           http://www.springframework.org/schema/context/spring-context.xsd">

    <!--注解驱动：配置处理器映射器和处理器适配器-->
    <mvc:annotation-driven/>

    <!--配置视图解析器-->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix" value="/view/"/>
        <property name="suffix" value=".html"/>
    </bean>

    <!--包扫描-->
    <context:component-scan base-package="com.joe.controller"/>

</beans>
```

# 4. 动作类

**概念：** 动作类就是我们的控制器类。
- `@RequestMapping` 是用来映射请求（提供对外接口）的，相当于Servlet中的 `@WebServlet` 注解。
- `@RequestMapping` 中的接口值可以省略 `.action` 后缀，但页面访问该接口时不能省略 `.action` 后缀。
- `@RequestMapping` 中的接口值可以省略两端的 `/`。
- 动作类的方法名可以随意一点，对于SpringMVC来讲不是很重要。
- 如果方法的返回值是String类型的，则return后面可以直接写返回路径，称为物理视图路径，物理视图路径需要配合视图解析器中配置的前后缀一起使用，如果你没有配置前后缀则必须写全路径。

**源码：**
```java
/**
 * @author JoeZhou
 */
@Controller
public class HelloController {

    @RequestMapping("/hello/test.action")
    public String hello() {
        System.out.println("Hello springMVC!!!");
        return "success";
    }
}
```

> 测试接口：hello/test.action

# 5. 静态资源访问

**概念：** 
- 如果 `web.xml` 中的前端控制器的拦截规则设置成了 `/` 的话会对所有静态资源（html/js/css等，不包括jsp）也进行拦截，然后进行一个核心和三个组件的处理过程，但是静态资源无法经过这些处理，所以最终导致我们无法访问这些静态资源，会报404错误。
- 如果必须要使用 `/`，还想能访问静态资源，可以对静态资源的单独配置，如下：

**配置：** web.xml
```xml
<servlet-mapping>
    <servlet-name>default</servlet-name>
    <url-pattern>*.html</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>default</servlet-name>
    <url-pattern>*.js</url-pattern>
</servlet-mapping>
<servlet-mapping>
    <servlet-name>default</servlet-name>
    <url-pattern>*.css</url-pattern>
</servlet-mapping>
```